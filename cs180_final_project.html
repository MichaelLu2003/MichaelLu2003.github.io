<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS180 Final Project</title>
</head>
<body>
    <h1>Maochuan Lu - Project 1 Gradient Domain Fusion</h1>

    <h2 style="font-size: 30px;">Overview</h2>
    <p style="font-size: 20px;">
        In this project, we are going to implement Poisson Blending and Mixed Gradient in Bells & Whistles to seamlessly blend an object or texture from a source image into a target image.
    </p>

    <h2 style="font-size: 30px;">Part 1 Toy Problem</h2>
    <p style="font-size: 20px;">
      In this part, I reconstruct a toy image from its gradients by solving a sparse linear system using least squares. 
      The process is same as the implementation details: I firstly try to map each pixel to a variable index and then I define a sparse matrix <code>A</code> and  
        <code>b</code>, which represent the x-gradients and y-gradients of the image. Additionally, I add a constriant for the top-left pixel to anchor the 
        reconstruction. The system <code>Av = b</code> is then solved using the <code>lsqr</code> method, and 
        the solution <code>v</code>. Here is my result: 
    </p>
    <img src="./final_project/gradient_domain/part1.png" width="600" alt="part1.png"> <br/>

    <h2 style="font-size: 30px;">Part 2 Poisson Blending</h2>
    <p>
        Poisson blending is a seamless image editing technique that merges an object image into a 
        background image using gradient domain manipulation. The goal is to solve for pixel values 
        within the mask region such that the gradients inside the mask match those of the object image 
        while maintaining consistency with the background image at the boundaries.
    </p>
    <h2>Mathematical Expression</h2>
    <p>
        The problem can be formulated as a minimization problem:
    </p>
    <div class="math">
        Minimize: 
        <br>
        <code>
            \[ \sum_{(x, y) \in \text{mask}} \| \nabla v(x, y) - \nabla \text{object}(x, y) \|^2 \]
        </code>
        <br>
        Subject to: 
        <br>
        <code>
            v(x, y) = \text{background}(x, y) \quad \forall (x, y) \in \text{boundary}.
        </code>
    </div>
    <p>
        Here:
        <ul>
            <li><code>\( v(x, y) \)</code> represents the pixel intensities to be blended.</li>
            <li><code>\( \nabla \)</code> denotes the gradient operator.</li>
            <li>The boundary condition ensures smooth transitions between the object and background.</li>
        </ul>
    </p>
    <h2>Steps in the Algorithm</h2>
    <ol>
        <li>
            <strong>Setup:</strong> Initializes variables for the object image, mask, and background image. 
            Each pixel in the mask is mapped to a variable, and neighboring relationships are represented 
            in a sparse matrix <code>A</code> and vector <code>b</code>.
        </li>
        <li>
            <strong>Gradient Constraints:</strong> For each pixel in the mask:
            <ul>
                <li>If the neighbor is inside the mask, the gradient from the object image is preserved.</li>
                <li>If the neighbor is outside the mask, the gradient is aligned with the background image.</li>
            </ul>
        </li>
        <li>
            <strong>Least Squares Solution:</strong> Solves the sparse linear system <code>Av = b</code> 
            using <code>lsqr</code>, where <code>v</code> contains the reconstructed pixel intensities.
        </li>
        <li>
            <strong>Blend and Return:</strong> Updates the pixels in the blended region and returns 
            the output image, seamlessly integrating the object into the background.
        </li>
    </ol>
    
    <img src="./proj3_pic/Part2.png" width="800" alt="Part2.png"> <br/>

    <h2 style="font-size: 30px;">Part 3</h2>
    <p style="font-size: 20px;">
        In Part 2, I created a GIF morph sequence with 45 frames, each with a duration of 30 ms. Since the GIF file was too large to upload to GitHub, I converted it into a YouTube video. You can watch it directly below:
    </p>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/ZCOOzz04D_g" 
        title="YouTube video player" frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen></iframe>

    <h2 style="font-size: 30px;">Part 4</h2>
    <p style="font-size: 20px;">
        I used the Danes dataset. I first get keypoints from .asf files for male and female images by parsing files.
        Then after i do this, I firgure out that my final image only has face without background and clothes.
        So I added extra points, specifically, I added points in the corners and boundaries.
        Then I computed the average face shape for all, male, and female keypoints separately. 
        In detail, for each image, I used Delaunay triangulation to warp the face into the average shape by applying affine transformations to each triangle. 
        Here is four examples: 
    </p>
    <img src="./proj3_pic/Part4.1.png" width="800" alt="Part4.1.png"> <br/>
    <img src="./proj3_pic/Part4.2.png" width="800" alt="Part4.2.png"> <br/>
    <img src="./proj3_pic/Part4.3.png" width="800" alt="Part4.3.png"> <br/>
    <img src="./proj3_pic/Part4.4.png" width="800" alt="Part4.4.png"> <br/>

     <p style="font-size: 20px;">
    I computed the average female, male, and Danes faces by warping each image to its average shape, averaging pixel values.
    Here is the result
    </p>
    <img src="./proj3_pic/Part4.5.png" width="1100" alt="Part4.5.png"> <br/>
    
    <p style="font-size: 20px;">
    Then, I loaded keypoints for me  and the average Dane face from a JSON file and warped both faces. I warped my face to the average Dane and also warped the 
    average Dane face to match my face. Here is the result.
    </p>
    <img src="./proj3_pic/Part4.6.png" width="800" alt="Part4.6.png"> <br/>
    

    <h2 style="font-size: 30px;">Part 5</h2>
    <p style="font-size: 20px;">
    I extrapolated my keypoints from the average Dane face by calculating the difference between them with alpha. I applied two different alphas (1.5 and -0.5) to exaggerate. 
        Here is the results using exaggerating points to warp my face to average Dane face. 
    </p>
    <img src="./proj3_pic/Part5.png" width="800" alt="Part5.png"> <br/>

    <h2 style="font-size: 30px;">Bells and Whistles: Gender Change</h2>
    <p style="font-size: 20px;">
    I want to change my face (male) to female. And I did following things:
    <u style="font-size: 20px;"l>
        <li><strong>Appearance only:</strong> Only the appearance of myself was morphed into the average Chinese female face.</li>
        <li><strong>Shape only:</strong> The shape was morphed halfway between me and the average female face.</li>
        <li><strong>Shape and Appearance:</strong> Both shape and appearance were blended between the two faces.</li>
    </ul>
    </p>
    <img src="./proj3_pic/Part6.png" width="800" alt="Part6.png"> <br/>
    <a href="cs180.html">Back to CS180 Projects</a>
</body>
</html>
