<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS180 Project 5</title>
    <style>
        .image-row {
            display: flex;
            justify-content: space-between;
        }

        .image-row img {
            width: 30%; 
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <h1>Maochuan Lu - CS180 Project 5</h1>

    <h2 style="font-size: 30px;">Part A: Overview</h2>
    <p style="font-size: 20px;">
       In Project5 part A, I will play around with diffusion models, implement diffusion sampling loops, and use them for other tasks such as inpainting and creating optical illusions. 
    </p>

    <h2 style="font-size: 30px;">Downloading Precomputed Text Embeddings</h2>
    <p style="font-size: 20px;">
        I use seeds = 180, and num_inference_steps = 10, 20, and 40, for the following pictures, 
        We can see that increasing num_inference_steps generally enhances the detail and clarity of generated images, also they all represent their corresponding prompt except the detail in the generated image is different: 
        at num_inference_steps = 10, images tend to be less detailed and may appear rough, with features like the hat being less defined, we can see that the man with hat looks like in a oil painting rather than a real photo.
        With 20 steps, there's a improvement, it shows a better clarity and more detail, we can see that the features in generated images are more recognizable.
        At 40 steps, images are at their most refined, with highly detailed textures, sharper edges, and natural shading, making features like the hat look more realistic.
    </p> 
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <h3>num_inference_steps = 10</h3>
        <img src="proj5a_pic/inference_step=10.png" alt="Image with 10 Inference Steps" width="800">
    </div>
    <div style="margin-bottom: 20px;">
        <h3>num_inference_steps = 20</h3>
        <img src="proj5a_pic/inference_step=20.png" alt="Image with 20 Inference Steps" width="800">
    </div>
    <div style="margin-bottom: 20px;">
        <h3>num_inference_steps = 40</h3>
        <img src="proj5a_pic/inference_step=40.png" alt="Image with 40 Inference Steps" width="800">
    </div>
</div>
    
    <h2 style="font-size: 30px;">1.1 Implementing the Forward Process</h2>
    <p style="font-size: 20px;">
        I generates noisy images of test_im at different noise levels based on specified timesteps (t=250, t=500, and t=750). 
        The forward function adds Gaussian noise to the image according to each timestep's cumulative alpha value. 
    </p> 
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.1.png" alt="1.1" width="800">
    </div>
    </div>
    

    <h2 style="font-size: 30px;">1.2 Classical Denoising</h2>
    <p style="font-size: 20px;">
        I generates noisy images of campanile at different timesteps (t=250, t=500, t=750), then applies Gaussian blur to each.
    </p> 
    
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <h3>Original campanile</h3>
        <img src="proj5a_pic/campanile.jpg" alt="original" width="200">
    </div>
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.2.png" alt="1.2" width="800">
    </div>
    </div>

    <h2 style="font-size: 30px;">1.3 One-Step Denoising</h2>
    <p style="font-size: 20px;">
       In this part, I generate noisy images at t=250, t=500, t=750). For each noisy image, I estimate the noise using a U-Net model with the prompt embedding "a high quality photo" 
        and performs one-step denoising to approximate a clean image.
    </p> 
    
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.3.png" alt="1.3" width="800">
    </div>
    </div>

    <h2 style="font-size: 30px;">1.4 Implementing Iterative Denoising</h2>
    <p style="font-size: 20px;">
       I implement iterative denoising on a noisy version of test_im using a U-Net model with a prompt embedding. 
        I first start by adding noise to test_im and then performs iterative denoising over several timesteps.
        Specifically, in the iterative_denoise function, each iteration calculates a progressively less noisy version of the image by estimating and removing noise. 
        For each timestep t, I use the formula provided to compute alpha and beta values based on cumulative noise, 
        then uses the U-Net model to predict the noise in the current image. 
        This predicted noise is subtracted to estimate a x0, and a weighted average between this estimate and the previous image gives the pred_prev_image for the next timestep. 
    </p> 
    
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.4.png" alt="1.4" width="1200">
    </div>
    </div>
    

    <h2 style="font-size: 30px;">1.5 Diffusion Model Sampling</h2>
    <p style="font-size: 20px;">
      I generate five random noisy images and iteratively denoises each one using a U-Net model with the text prompt "a high quality photo". 
        For each noisy image, I use the iterative_denoise function to progressively reduce noise over a series of timesteps, resulting in cleaner images.  
    </p> 
    
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.5.png" alt="1.5" width="800">
    </div>
    </div>

    <h2 style="font-size: 30px;">1.6 Classifier Free Guidance</h2>
    <p style="font-size: 20px;">
      The quality of previous part's image are not very good, so I use CFG to improve. It is really similar to iteratively denosing.
    Basically, I denoise five randomly generated noisy images, refining each towards a cleaner version guided by a specific prompt. 
        It first defines conditional and unconditional embeddings for CFG. Then I progressively removes noise from each image across a series of timesteps by combining noise estimates from both conditional and unconditional models by using the formula of CFG. 
        In this case, we can direct the denoising process towards the desired prompt ("a high quality photo").
        
    </p> 
    
    <div style="text-align: center;">
    <div style="margin-bottom: 20px;">
        <img src="proj5a_pic/1.6.png" alt="1.6" width="800">
    </div>
    </div>
    

    

    
    
</body>
</html>
    
